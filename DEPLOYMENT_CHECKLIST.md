# Deployment Checklist - Next Steps

## ‚úÖ Completed
- [x] Created `requirements.txt` with all dependencies
- [x] Created `render.yaml` for multi-service deployment
- [x] Updated Flask app for production (environment variables, health checks)
- [x] Updated FastAPI config for Render environment
- [x] Created `.renderignore` to exclude unnecessary files
- [x] Removed unnecessary files and directories
- [x] Updated `.gitignore` to allow model files

## üìã Next Steps for Render Deployment

### Step 1: Verify Model Files
Make sure your model files are in the `weights/` directory:
```bash
ls -lh weights/
```
You should see:
- `best_swapped.pt` (or `best.pt`)
- Model files should be committed to Git (`.gitignore` updated)

### Step 2: Commit All Changes
```bash
# Add all new and modified files
git add .

# Commit the changes
git commit -m "Prepare project for Render deployment"

# Push to your repository
git push origin main
```

### Step 3: Deploy to Render

#### Option A: Using Blueprint (Recommended - Easiest)
1. Go to https://dashboard.render.com
2. Click **"New +"** ‚Üí **"Blueprint"**
3. Connect your Git repository (GitHub/GitLab/Bitbucket)
4. Render will automatically detect `render.yaml` and create both services
5. Review the services and click **"Apply"**

#### Option B: Manual Service Creation
If you prefer manual setup:

**Create FastAPI Service:**
1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your repository
3. Configure:
   - **Name**: `fire-detection-api`
   - **Environment**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `cd platform && python -m uvicorn fastapi_app.main:app --host 0.0.0.0 --port $PORT`
   - **Environment Variables**: (see render.yaml for full list)

**Create Flask Dashboard Service:**
1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect the same repository
3. Configure:
   - **Name**: `fire-detection-dashboard`
   - **Environment**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `cd platform/backend && gunicorn --worker-class eventlet -w 1 --bind 0.0.0.0:$PORT --timeout 120 app:app`
   - **Environment Variables**:
     - `FASTAPI_BASE`: Set to your FastAPI service URL (e.g., `https://fire-detection-api.onrender.com`)

### Step 4: Configure Environment Variables

After services are created, verify these environment variables:

**FastAPI Service:**
- `MODEL_PATH`: `weights/best_swapped.pt`
- `DEVICE`: `cpu`
- `CONF_THRESHOLD`: `0.10`
- `IMGSZ`: `512`
- `ALERT_CONF_THRESHOLD`: `0.50`
- `WARMUP`: `true`
- `ALLOW_ORIGINS`: `*`

**Flask Service:**
- `SECRET_KEY`: Auto-generated by Render
- `SQLALCHEMY_DATABASE_URI`: `sqlite:///instance/alerts.db`
- `FASTAPI_BASE`: Auto-set from FastAPI service (if using Blueprint)

### Step 5: Monitor Deployment

1. **Watch Build Logs**: Check the build process in Render dashboard
2. **Check Health Endpoints**:
   - FastAPI: `https://your-api-url.onrender.com/detect/status`
   - Flask: `https://your-dashboard-url.onrender.com/api/health`
3. **Test the Application**:
   - Visit your Flask dashboard URL
   - Try uploading an image
   - Verify alerts are created

### Step 6: Important Notes

‚ö†Ô∏è **Model File Size**: 
- If your model files are large (>100MB), you may need to:
  - Use Render's persistent disk (paid plans)
  - Or download models from cloud storage on startup
  - Or commit to Git if under 100MB

‚ö†Ô∏è **Free Tier Limitations**:
- Services spin down after 15 minutes of inactivity
- First request after spin-down takes ~30-60 seconds
- Consider upgrading to Starter plan ($7/month) for always-on services

‚ö†Ô∏è **Database**:
- SQLite is used by default (ephemeral on free tier)
- For production, consider PostgreSQL (Render offers free PostgreSQL)

### Step 7: Troubleshooting

If deployment fails:

1. **Check Build Logs**: Look for Python version or dependency issues
2. **Verify Model Path**: Ensure model file exists in `weights/` directory
3. **Check Service Communication**: Verify `FASTAPI_BASE` is set correctly
4. **Review Logs**: Check runtime logs for errors

### Step 8: Post-Deployment

1. **Update CORS** (if needed): If you have a custom domain, update `ALLOW_ORIGINS`
2. **Set Up Custom Domain** (optional): Configure in Render dashboard
3. **Monitor Performance**: Check Render metrics
4. **Set Up Alerts**: Configure Render notifications

## üéâ You're Ready!

Your project is now prepared for deployment. Follow the steps above to deploy to Render.

For detailed information, see `RENDER_DEPLOYMENT.md`.
